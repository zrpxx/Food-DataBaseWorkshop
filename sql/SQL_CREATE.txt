CREATE TABLE NUTRITION(
    ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL ,
    CARBOHYDRATE DOUBLE NOT NULL ,
    SUGAR DOUBLE NOT NULL ,
    PROTEIN DOUBLE NOT NULL ,
    FAT DOUBLE NOT NULL ,
    ENERGY_KCAL DOUBLE NOT NULL
);

CREATE TABLE USER(
    UID INT PRIMARY KEY AUTO_INCREMENT NOT NULL ,
    USERNAME VARCHAR(20) NOT NULL UNIQUE ,
    PASSWORD VARCHAR(30) NOT NULL ,
    REGISTER_TIME DATE NOT NULL,
    ROLE INT DEFAULT 0 NOT NULL
);

CREATE TABLE NUTRI_SCORE(
    ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL ,
    R VARCHAR(5) NOT NULL ,
    DES VARCHAR(50) NOT NULL
);

CREATE TABLE BRAND(
    ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL ,
    NAME VARCHAR(20) NOT NULL UNIQUE ,
    PRODUCT_COUNT INT NOT NULL
);

CREATE TABLE CATEGORY(
    ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL ,
    NAME VARCHAR(20) NOT NULL UNIQUE 
);


CREATE TABLE FOOD (
    ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL ,
    NAME VARCHAR(40) NOT NULL ,
    NUTRI_ID INT NOT NULL ,
    BRAND_ID INT NOT NULL ,
    SCORE_ID INT NOT NULL ,
    CREATOR_ID INT NOT NULL ,
    FOREIGN KEY (NUTRI_ID) REFERENCES NUTRITION(ID),
    FOREIGN KEY (BRAND_ID) REFERENCES BRAND(ID),
    FOREIGN KEY (SCORE_ID) REFERENCES NUTRI_SCORE(ID),
    FOREIGN KEY (CREATOR_ID) REFERENCES USER(UID)
);

CREATE TABLE F_R_C(
    ID INT PRIMARY KEY AUTO_INCREMENT NOT NULL ,
    FOOD_ID INT NOT NULL ,
    CATEGORY_ID INT NOT NULL,
    FOREIGN KEY (FOOD_ID) REFERENCES FOOD(ID),
    FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY(ID)
);


DELIMITER $
CREATE TRIGGER BRAND_INCRE AFTER INSERT
    ON FOOD FOR EACH ROW
    BEGIN
        DECLARE C INT;
        SET C = (SELECT PRODUCT_COUNT FROM BRAND WHERE ID=NEW.BRAND_ID);
        UPDATE BRAND SET PRODUCT_COUNT = C + 1 WHERE ID=NEW.BRAND_ID;
    end $
DELIMITER ;

DELIMITER $
CREATE TRIGGER BRAND_DECRE AFTER DELETE
    ON FOOD FOR EACH ROW
    BEGIN
        DECLARE C INT;
        SET C = (SELECT PRODUCT_COUNT FROM BRAND WHERE ID=OLD.BRAND_ID);
        UPDATE BRAND SET PRODUCT_COUNT = C - 1 WHERE ID=OLD.BRAND_ID;
    end $
DELIMITER ;


insert into USER(username, password, register_time) value ('administrator', 'qazwsxedc', NOW())

INSERT INTO nutri_score (R, DES) VALUE ('A', 'Very good nutritional quality');
INSERT INTO nutri_score (R, DES) VALUE ('B', 'Good nutritional quality');
INSERT INTO nutri_score (R, DES) VALUE ('C', 'Average nutritional quality');
INSERT INTO nutri_score (R, DES) VALUE ('D', 'Poor nutritional quality');
INSERT INTO nutri_score (R, DES) VALUE ('E', 'Bad nutritional quality');
